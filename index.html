<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Class Companion</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ical.js/1.4.0/ical.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>
<body class="bg-gray-100 min-h-screen">

    <nav class="bg-white shadow-md sticky top-0 z-30">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <span class="text-xl font-bold text-indigo-600">Class Companion</span>
                </div>
                <div class="flex items-center space-x-4">
                    <button data-section="calendar" class="nav-link text-gray-600 hover:text-indigo-600 px-3 py-2 rounded-md text-sm font-medium transition duration-150 ease-in-out active">Calendar</button>
                    <button data-section="canvas" class="nav-link text-gray-600 hover:text-indigo-600 px-3 py-2 rounded-md text-sm font-medium transition duration-150 ease-in-out">Canvas</button>
                    <button data-section="settings" class="nav-link text-gray-600 hover:text-indigo-600 px-3 py-2 rounded-md text-sm font-medium transition duration-150 ease-in-out">Settings</button>
                </div>
            </div>
        </div>
    </nav>

    <main class="max-w-7xl mx-auto p-4 md:p-8">

        <section id="settingsSection" class="content-bg rounded-lg shadow-lg p-6 md:p-8 mb-8 hidden fade-in">
            <h2 class="text-xl md:text-2xl font-bold text-gray-800 mb-6 border-b pb-2">Settings</h2>

            <div class="mb-8 pb-6 border-b">
                <h3 class="text-lg font-semibold text-gray-700 mb-3">Proxy & Compass Feed</h3>
                 <label for="workerUrl" class="block text-sm font-medium text-gray-700 mb-2">Cloudflare Worker URL:</label>
                <input type="url" id="workerUrl" placeholder="https://your-worker.your-name.workers.dev" class="block w-full px-3 py-2 mb-3 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">

                <label for="calendarUrl" class="block text-sm font-medium text-gray-700 mb-2">Compass Calendar Feed URL (.ics):</label>
                <div class="flex flex-col sm:flex-row gap-2">
                    <input type="url" id="calendarUrl" placeholder="https://your-school.compass.education/..." class="flex-grow block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                    <button id="loadCalendarBtn" class="bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-2 px-4 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-150 ease-in-out whitespace-nowrap">
                        Save & Load Compass
                    </button>
                </div>
                 <p class="mt-2 text-xs text-gray-500">Your Worker URL and Compass URL are saved locally. Auto-refresh every 10 seconds is enabled.</p>
            </div>

            <div class="mb-8 pb-6 border-b">
                <h3 class="text-lg font-semibold text-gray-700 mb-3">Class Naming & Coloring (Compass)</h3>
                <p class="text-sm text-gray-600 mb-1">Define short codes found in your Compass class names.</p>
                <p class="text-sm text-gray-600 mb-4">If a code is found anywhere within a class name (e.g., 'ENG' in '09ENG1B01'), the <strong class="font-medium">entire original class name</strong> will be replaced with the "Full Name" you provide (e.g., 'English'). Assign colors for identification.</p>
                <div id="mappingsList" class="mb-4 space-y-2"></div>
                <div class="flex flex-col sm:flex-row gap-2">
                     <input type="text" id="newMappingCode" placeholder="Code (e.g., ENG)" class="px-3 py-2 border border-gray-300 rounded-md shadow-sm sm:text-sm">
                     <input type="text" id="newMappingName" placeholder="Full Name (e.g., English)" class="flex-grow px-3 py-2 border border-gray-300 rounded-md shadow-sm sm:text-sm">
                     <div class="flex items-center gap-2">
                        <select id="newMappingPastelColor" class="px-3 py-2 border border-gray-300 rounded-md shadow-sm sm:text-sm bg-white">
                            <option value="">-- Pastel --</option>
                        </select>
                        <span class="text-sm text-gray-500">or</span>
                        <input type="color" id="newMappingColor" value="#e5e7eb" class="h-auto p-1 border border-gray-300 rounded-md shadow-sm cursor-pointer">
                     </div>
                     <button id="addMappingBtn" class="bg-green-600 hover:bg-green-700 text-white font-semibold py-2 px-4 rounded-md shadow-sm text-sm">Add</button>
                </div>
            </div>

            <div class="mb-8 pb-6 border-b">
                <h3 class="text-lg font-semibold text-gray-700 mb-3">Canvas Integration</h3>
                 <p class="text-sm text-gray-600 mb-2">Ensure your Cloudflare Worker URL is set above.</p>
                 <label for="canvasDomain" class="block text-sm font-medium text-gray-700 mb-2">Canvas Domain:</label>
                <input type="url" id="canvasDomain" placeholder="https://yourinstitution.instructure.com" class="block w-full px-3 py-2 mb-3 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                <label for="canvasToken" class="block text-sm font-medium text-gray-700 mb-2">Canvas API Access Token:</label>
                <input type="password" id="canvasToken" placeholder="Paste your token here" class="block w-full px-3 py-2 mb-3 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                <button id="saveCanvasSettingsBtn" class="bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-2 px-4 rounded-md shadow-sm text-sm">Save Canvas Settings & Fetch</button>
                <p class="mt-2 text-xs text-gray-500">Your Canvas domain and token are saved locally.</p>
            </div>

            <div class="mb-8 pb-6 border-b">
                <h3 class="text-lg font-semibold text-gray-700 mb-3">Compass Class to Canvas Course Mapping</h3>
                <p class="text-sm text-gray-600 mb-4">Link your Compass class names (after your custom naming above is applied) to your Canvas Course IDs. Get Course IDs from the URL of a Canvas course page (e.g., .../courses/COURSE_ID).</p>
                <div id="canvasCourseMappingsList" class="mb-4 space-y-2"></div>
                <div class="flex flex-col sm:flex-row gap-2">
                     <input type="text" id="compassClassNameForCanvas" placeholder="Compass Class Name" class="flex-grow px-3 py-2 border border-gray-300 rounded-md shadow-sm sm:text-sm mb-2 sm:mb-0">
                     <input type="text" id="canvasCourseIdForMapping" placeholder="Canvas Course ID" class="flex-grow px-3 py-2 border border-gray-300 rounded-md shadow-sm sm:text-sm">
                     <button id="addCanvasCourseMappingBtn" class="bg-green-600 hover:bg-green-700 text-white font-semibold py-2 px-4 rounded-md shadow-sm text-sm">Add Mapping</button>
                </div>
            </div>

            <div class="mb-8 pb-6 border-b">
                <h3 class="text-lg font-semibold text-gray-700 mb-3">Notifications</h3>
                <div id="notificationPermissionStatus" class="text-sm text-gray-600 mb-3"></div>
                <div class="space-y-3">
                    <div class="notification-preference">
                        <input type="checkbox" id="notifyClassesEnabled">
                        <label for="notifyClassesEnabled" class="font-medium text-gray-700">Class Reminders:</label>
                        <input type="number" id="notifyClassesLeadTime" min="1" class="border-gray-300 rounded-md shadow-sm">
                        <span class="ml-2 text-sm text-gray-500">minutes before</span>
                    </div>
                    <div class="notification-preference">
                        <input type="checkbox" id="notifyAssignmentsEnabled1">
                        <label for="notifyAssignmentsEnabled1" class="font-medium text-gray-700">Assignment Reminder 1:</label>
                        <input type="number" id="notifyAssignmentsLeadTime1" min="1" class="border-gray-300 rounded-md shadow-sm">
                        <span class="ml-2 text-sm text-gray-500">minutes before due</span>
                    </div>
                     <div class="notification-preference">
                        <input type="checkbox" id="notifyAssignmentsEnabled2">
                        <label for="notifyAssignmentsEnabled2" class="font-medium text-gray-700">Assignment Reminder 2:</label>
                        <input type="number" id="notifyAssignmentsLeadTime2" min="1" class="border-gray-300 rounded-md shadow-sm">
                        <span class="ml-2 text-sm text-gray-500">minutes before due</span>
                    </div>
                     <div class="notification-preference">
                        <input type="checkbox" id="notifyTimetableChangesEnabled">
                        <label for="notifyTimetableChangesEnabled" class="font-medium text-gray-700">Timetable Changes:</label>
                        <span class="ml-2 text-sm text-gray-500">(Room, Time, Cancellation)</span>
                    </div>
                </div>
                <button id="saveNotificationSettingsBtn" class="mt-4 bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-md shadow-sm text-sm">Save Notification Preferences</button>
            </div>


             <div class="mb-8">
                <h3 class="text-lg font-semibold text-gray-700 mb-3">Appearance</h3>
                <label for="backgroundUrl" class="block text-sm font-medium text-gray-700 mb-2">Custom Background Image URL:</label>
                <div class="flex flex-col sm:flex-row gap-2">
                    <input type="url" id="backgroundUrl" placeholder="Enter image URL..." class="flex-grow block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                    <button id="saveBackgroundBtn" class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition duration-150 ease-in-out whitespace-nowrap">Save BG</button>
                     <button id="resetBackgroundBtn" class="bg-gray-400 hover:bg-gray-500 text-white font-semibold py-2 px-4 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-400 transition duration-150 ease-in-out whitespace-nowrap">Reset BG</button>
                </div>
                 <p class="mt-2 text-xs text-gray-500">Leave blank to use the default background.</p>
            </div>

             <div id="settingsMessageArea" class="text-center my-4"></div>
        </section>

        <section id="calendarSection" class="hidden fade-in">
             <div class="flex flex-col lg:flex-row gap-6">
                 <div class="flex-grow content-bg rounded-lg shadow-lg p-6 md:p-8 overflow-hidden">
                     <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-2 gap-4">
                         <h2 class="text-xl md:text-2xl font-bold text-gray-800 whitespace-nowrap">Your Schedule</h2>
                         <div class="flex items-center gap-2 border border-gray-300 rounded-md p-0.5 bg-gray-100">
                             <button id="listViewBtn" data-view="list" class="view-toggle-btn px-3 py-1 rounded-md text-sm font-medium transition duration-150 ease-in-out active">List</button>
                             <button id="weekViewBtn" data-view="week" class="view-toggle-btn px-3 py-1 rounded-md text-sm font-medium transition duration-150 ease-in-out">Week</button>
                         </div>
                     </div>
                     <div id="statusIndicator" class="status-indicator mb-6">
                         <span id="statusIcon" class="status-icon"></span>
                         <span id="statusText" class="status-text"></span>
                     </div>
                     <div id="listControls" class="flex flex-col md:flex-row gap-4 mb-6">
                         <div class="flex-grow">
                             <label for="searchBox" class="sr-only">Search Events</label>
                             <input type="search" id="searchBox" placeholder="Search events (class, room, teacher)..." class="block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                         </div>
                         <div>
                             <label for="sortOrder" class="sr-only">Sort Events By</label>
                             <select id="sortOrder" class="block w-full md:w-auto px-3 py-2 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                                 <option value="time">Sort by Time</option>
                                 <option value="name">Sort by Class Name</option>
                                 <option value="location">Sort by Location</option>
                             </select>
                         </div>
                     </div>
                     <div id="calendarMessageArea" class="text-center my-4"></div>
                     <div id="calendarDisplayList" class="space-y-4"></div>
                      <div id="calendarDisplayWeek" class="hidden">
                         <div class="weekly-grid-container">
                             <div class="grid grid-cols-[60px_repeat(5,minmax(100px,1fr))] gap-1 sticky top-0 z-20">
                                <div class="grid-header">Time</div> <div class="grid-header">Mon</div> <div class="grid-header">Tue</div> <div class="grid-header">Wed</div> <div class="grid-header">Thu</div> <div class="grid-header">Fri</div>
                             </div>
                             <div id="weeklyViewGrid" class="weekly-grid"></div>
                         </div>
                     </div>
                 </div>
                 <aside id="sidebar" class="content-bg rounded-lg shadow-lg p-4 lg:sticky lg:top-24 lg:self-start">
                     <h3 class="text-lg font-semibold text-gray-700 mb-4 border-b pb-2">Other Events & Due Dates</h3>
                     <div id="sidebarEvents" class="space-y-3 max-h-[70vh] overflow-y-auto"></div>
                 </aside>
             </div>
        </section>

        <section id="canvasSection" class="hidden fade-in">
            <div class="content-bg rounded-lg shadow-lg p-6 md:p-8">
                <h2 class="text-xl md:text-2xl font-bold text-gray-800 mb-6">Canvas Details</h2>
                <div id="canvasDataMessageArea" class="text-center my-4"></div>
                <div id="canvasCoursesDisplay" class="space-y-6">
                    </div>
            </div>
        </section>

    </main>

    <script src="script.js" defer></script>
</body>
</html>
